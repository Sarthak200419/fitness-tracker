{% extends "base.html" %}

{% block title %}Statistics - FitPlus{% endblock %}

{% block extra_css %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<div class="stats-page">
    <h1>Your Statistics</h1>

    <div class="stats-grid">
        <!-- Weekly Summary -->
        <div class="stats-card">
            <h2>Weekly Summary</h2>
            <canvas id="weeklyChart"></canvas>
        </div>

        <!-- Workout Breakdown -->
        <div class="stats-card">
            <h2>Workouts by Type</h2>
            <canvas id="typeChart"></canvas>
        </div>
    </div>

    <!-- Detailed Stats -->
    <div class="detailed-stats">
        <h2>Last 30 Days</h2>

        {% if weekly_stats %}
        <table class="stats-table">
            <thead>
                <tr>
                    <th>Week</th>
                    <th>Workouts</th>
                    <th>Duration (min)</th>
                    <th>Calories Burned</th>
                </tr>
            </thead>
            <tbody>
                {% for week, stats in weekly_stats.items() %}
                <tr>
                    <td>{{ week }}</td>
                    <td>{{ stats.workouts }}</td>
                    <td>{{ stats.duration }}</td>
                    <td>{{ stats.calories|round(0)|int }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="no-data">No data available for the last 30 days.</p>
        {% endif %}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Weekly stats data
        const weeklyData = {{ weekly_stats| tojson
    }};

    // Weekly Chart
    const weeklyCtx = document.getElementById('weeklyChart');
    if (weeklyCtx && Object.keys(weeklyData).length > 0) {
        new Chart(weeklyCtx, {
            type: 'line',
            data: {
                labels: Object.keys(weeklyData),
                datasets: [
                    {
                        label: 'Workouts',
                        data: Object.values(weeklyData).map(w => w.workouts),
                        borderColor: '#2196F3',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: true
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
});
</script>

<style>
    .stats-page {
        padding: 2rem 0;
    }

    .stats-page h1 {
        margin-bottom: 2rem;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .stats-card {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .stats-card h2 {
        margin-top: 0;
        margin-bottom: 1rem;
        font-size: 1.25rem;
        color: #333;
    }

    .detailed-stats {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .detailed-stats h2 {
        margin-top: 0;
        margin-bottom: 1rem;
        color: #333;
    }

    .stats-table {
        width: 100%;
        border-collapse: collapse;
    }

    .stats-table thead {
        background: #f5f5f5;
    }

    .stats-table th {
        padding: 1rem;
        text-align: left;
        font-weight: 600;
        color: #666;
        border-bottom: 2px solid #eee;
    }

    .stats-table td {
        padding: 1rem;
        border-bottom: 1px solid #eee;
    }

    .stats-table tr:hover {
        background: #f9f9f9;
    }

    .no-data {
        text-align: center;
        color: #999;
        padding: 2rem;
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}